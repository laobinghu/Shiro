import{r as e,j as E}from"./index-CaQNHPqR.js";import{M as S,u as $,P as v,a as W,L as A}from"./proxy-BY0eS7VU.js";class D extends e.Component{getSnapshotBeforeUpdate(o){const t=this.props.childRef.current;if(t&&o.isPresent&&!this.props.isPresent){const s=t.offsetParent,f=s instanceof HTMLElement&&s.offsetWidth||0,r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft,r.right=f-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function H({children:n,isPresent:o,anchorX:t}){const s=e.useId(),f=e.useRef(null),r=e.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=e.useContext(S);return e.useInsertionEffect(()=>{const{width:C,height:u,top:P,left:i,right:p}=r.current;if(o||!f.current||!C||!u)return;const d=t==="left"?`left: ${i}`:`right: ${p}`;f.current.dataset.motionPopId=s;const l=document.createElement("style");return a&&(l.nonce=a),document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${C}px !important;
            height: ${u}px !important;
            ${d}px !important;
            top: ${P}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[o]),E.jsx(D,{isPresent:o,childRef:f,sizeRef:r,children:e.cloneElement(n,{ref:f})})}const K=({children:n,initial:o,isPresent:t,onExitComplete:s,custom:f,presenceAffectsLayout:r,mode:a,anchorX:C})=>{const u=$(U),P=e.useId(),i=e.useCallback(d=>{u.set(d,!0);for(const l of u.values())if(!l)return;s&&s()},[u,s]),p=e.useMemo(()=>({id:P,initial:o,isPresent:t,custom:f,onExitComplete:i,register:d=>(u.set(d,!1),()=>u.delete(d))}),r?[Math.random(),i]:[t,i]);return e.useMemo(()=>{u.forEach((d,l)=>u.set(l,!1))},[t]),e.useEffect(()=>{!t&&!u.size&&s&&s()},[t]),a==="popLayout"&&(n=E.jsx(H,{isPresent:t,anchorX:C,children:n})),E.jsx(v.Provider,{value:p,children:n})};function U(){return new Map}function B(n=!0){const o=e.useContext(v);if(o===null)return[!0,null];const{isPresent:t,onExitComplete:s,register:f}=o,r=e.useId();e.useEffect(()=>{if(n)return f(r)},[n]);const a=e.useCallback(()=>n&&s&&s(r),[r,s,n]);return!t&&s?[!1,a]:[!0]}function V(){return F(e.useContext(v))}function F(n){return n===null?!0:n.isPresent}const R=n=>n.key||"";function I(n){const o=[];return e.Children.forEach(n,t=>{e.isValidElement(t)&&o.push(t)}),o}const X=({children:n,custom:o,initial:t=!0,onExitComplete:s,presenceAffectsLayout:f=!0,mode:r="sync",propagate:a=!1,anchorX:C="left"})=>{const[u,P]=B(a),i=e.useMemo(()=>I(n),[n]),p=a&&!u?[]:i.map(R),d=e.useRef(!0),l=e.useRef(i),x=$(()=>new Map),[k,z]=e.useState(i),[m,w]=e.useState(i);W(()=>{d.current=!1,l.current=i;for(let h=0;h<m.length;h++){const c=R(m[h]);p.includes(c)?x.delete(c):x.get(c)!==!0&&x.set(c,!1)}},[m,p.length,p.join("-")]);const y=[];if(i!==k){let h=[...i];for(let c=0;c<m.length;c++){const g=m[c],M=R(g);p.includes(M)||(h.splice(c,0,g),y.push(g))}return r==="wait"&&y.length&&(h=y),w(I(h)),z(i),null}const{forceRender:L}=e.useContext(A);return E.jsx(E.Fragment,{children:m.map(h=>{const c=R(h),g=a&&!u?!1:i===m||p.includes(c),M=()=>{if(x.has(c))x.set(c,!0);else return;let j=!0;x.forEach(T=>{T||(j=!1)}),j&&(L?.(),w(l.current),a&&P?.(),s&&s())};return E.jsx(K,{isPresent:g,initial:!d.current||t?void 0:!1,custom:o,presenceAffectsLayout:f,mode:r,onExitComplete:g?void 0:M,anchorX:C,children:h},c)})})};export{X as A,V as a,B as u};
